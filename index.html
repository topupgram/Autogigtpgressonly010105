<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form Pembelian Robux</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body{
  font-family:Roboto,sans-serif;
  background:#fff;
  padding:20px;
  font-size:13px
}
.form-box{
  max-width:480px;
  margin:auto;
  border:1px solid #d1d9e6;
  border-radius:10px;
  padding:20px;
  background:#fafafa
}
h2{text-align:center;margin-bottom:15px}
label{font-weight:500;margin-bottom:5px;display:block}
input,select,textarea{
  width:100%;
  padding:8px;
  margin-bottom:12px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:13px
}
textarea{min-height:70px}
button{
  width:100%;
  padding:10px;
  border:none;
  background:#4a6fa1;
  color:#fff;
  border-radius:6px;
  font-weight:600;
  cursor:pointer
}
.hidden{display:none}
.note{font-size:11px;color:#666}

/* ===== PAYMENT MODAL ===== */
#paymentModalBackdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999
}
#paymentModal{
  background:#fff;
  width:90%;
  max-width:320px;
  border-radius:10px;
  padding:15px;
  text-align:center
}
.method-btn{
  padding:6px 10px;
  margin:4px;
  border-radius:6px;
  border:1px solid #ccc;
  cursor:pointer;
  background:#f5f5f5;
  font-size:12px
}
.method-btn:hover{background:#eaeaea}
#modalQr{width:100%;margin:10px 0}
</style>
</head>

<body>

<div class="form-box">
<h2>Form Pembelian Robux</h2>

<form id="frm">
<label>Username Roblox *</label>
<input type="text" id="usr" required>

<label>Display Name *</label>
<input type="text" id="dsp" required>

<label>Maps *</label>
<select id="map" required>
  <option value="">-- Pilih --</option>
  <option value="GAMEPASS">1. Robux Gamepass NO TAX (5â€“7 days)</option>
  <option value="0">0. Game lain (ketik manual)</option>
  <option>Adopt Me</option>
  <option>Blox Fruit</option>
  <option>BedWars</option>
  <option>Brookhaven</option>
</select>

<div id="mapCustomGroup" class="hidden">
  <label>Nama Game *</label>
  <input type="text" id="mapCustom">
</div>

<div id="itemGroup">
  <label>Item / Order *</label>
  <textarea id="itm"></textarea>
</div>

<div id="gpGroup" class="hidden">
  <label>Link / ID Gamepass *</label>
  <input type="text" id="gpLink">
</div>

<label>Jumlah Robux *</label>
<input type="number" id="rbx" min="1" required>
<div id="rbxNote" class="note">Rate Rp85 / Robux</div>

<label>Total Harga</label>
<input type="text" id="hg" readonly>

<button type="button" id="btnTg">Pesan & Lanjut Payment</button>
</form>
</div>

<!-- ===== PAYMENT MODAL ===== -->
<div id="paymentModalBackdrop">
  <div id="paymentModal">
    <h3>Pilih Metode Pembayaran</h3>
    <div>
      <button class="method-btn" data-method="qris">QRIS</button>
      <button class="method-btn" data-method="gopay">GoPay</button>
      <button class="method-btn" data-method="seabank">SeaBank</button>
      <button class="method-btn" data-method="dana">DANA</button>
    </div>
    <img id="modalQr" src="">
    <p>Total Bayar:<br><strong id="modalAmount"></strong></p>
    <button id="closeModalBtn">Tutup</button>
  </div>
</div>

<script>
const RATE = 85;
const rbxEl = rbx;
const hgEl = hg;
const itmEl = itm;

map.addEventListener('change',()=>{
  if(map.value==='GAMEPASS'){
    itemGroup.classList.add('hidden');
    gpGroup.classList.remove('hidden');
    rbxNote.innerText='Isi sesuai Jumlah Robux pada gamepass';
  }else{
    itemGroup.classList.remove('hidden');
    gpGroup.classList.add('hidden');
    rbxNote.innerText='Rate saat ini Rp85 / Robux';
  }
  mapCustomGroup.classList.toggle('hidden',map.value!=='0');
});

rbxEl.addEventListener('input',()=>{
  const total=rbxEl.value*RATE;
  hgEl.value='Rp'+total.toLocaleString('id-ID');
});

function sanitize(v){return Number(String(v).replace(/\D+/g,''))}
function formatRp(v){return 'Rp'+v.toLocaleString('id-ID')}

btnTg.onclick=()=>{
  if(!frm.checkValidity()){alert('Lengkapi data!');return}

  let mapName = map.value==='0'?mapCustom.value:map.options[map.selectedIndex].text;
  let detail = map.value==='GAMEPASS'?'Gamepass: '+gpLink.value:'Item: '+itmEl.value;

  let msg =
`Pesanan Baru
Username: ${usr.value}
Display: ${dsp.value}
Map: ${mapName}

${detail}
Robux: ${rbxEl.value}
Total: ${hgEl.value}`;

  fetch('https://api.telegram.org/bot1868293159:AAF7IWMtOEqmVqEkBAfCTexkj_siZiisC0E/sendMessage',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({chat_id:'-1002801058966',text:msg})
  }).then(()=>{
    showPayment(hgEl.value);
    frm.reset();
  });
};

function showPayment(hgFmt){
  const base=sanitize(hgFmt);
  const QR="https://payment.uwu.ai/assets/images/gallery03/8555ed8a_original.jpg?v=58e63277";

  function apply(m){
    let t=base;
    if(m==='qris'&&base>499000)t=Math.round(base*1.003);
    if(m==='dana')t+=100;
    modalAmount.innerText=formatRp(t);
    modalQr.src=QR;
    modalQr.style.display=m==='qris'?'block':'none';
  }

  apply('qris');
  paymentModalBackdrop.style.display='flex';

  document.querySelectorAll('.method-btn').forEach(b=>{
    b.onclick=()=>apply(b.dataset.method);
  });
}

closeModalBtn.onclick=()=>paymentModalBackdrop.style.display='none';
</script>

</body>
</html>
